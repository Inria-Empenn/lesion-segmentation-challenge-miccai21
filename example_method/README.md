# Install, publish and use the example method

*Note: Those instructions are only provided as an example to help you submit your method. Please read the [submission guidelines](SUBMISSION_GUIDELINES.md) first.*

## Build the Docker image

- To build the GPU version, run `docker build -f Dockerfile.gpu -t YOUR-USER-NAME/msseg-gpu-example .`
- To build the CPU version, run `docker build -f Dockerfile.cpu -t YOUR-USER-NAME/msseg-cpu-example .`

## Run the Docker image

Put your two flairs images (`flair_time01.nii.gz` and `flair_time02.nii.gz`) in your working directory (for example `/path/to/miccai21/example_method/`), where you will execute the following command:

`docker run --entrypoint=/bin/sh --rm -v /path/to/miccai21/example_method/:/working-directory/ -w /working-directory/ arthurmassoninria/msseg-example:latest process.sh`

This is the command that will be generated by Boutiques on the VIP platform.

Please include all scripts and data for your method in your image. 
Just consider that the working directory (where the container will be launched) contains the two flairs and will receive the output segmentation. 

Be aware that the path to the working directory (`/working-directory/`) is automatically set by Boutiques, and we have no control over it ; so you should not rely on it.

You main script should be copied in your image, as in this example method where the last statement copies the `process.py` script into the `/nnunet/`:

`COPY process.py /nnunet/`

And the command line defined in the descriptor contains the full path to the script: 

`python /nnunet/process.py -t1 [FLAIR1] -t2 [FLAIR2] -o [SEGMENTATION]`.

In this way, the script will be found no matter where the method is executed.

## Publish the Docker image

- Login to the Docker Hub using the command `docker login -u YOUR-USER-NAME`
- docker push YOUR-USER-NAME/msseg-cpu-example

## Publish the Boutiques descriptor

- Install [Boutiques](https://boutiques.github.io/).
- Create an account on Zenodo, the publishing platform used by Boutiques. 
- Create a new personal access token on the [applications page](https://zenodo.org/account/settings/applications/) of your Zenodo account so that bosh can publish descriptors under your name.
- Publish the descriptor with your personal access token: `bosh publish --zenodo-token ACCESS_TOKEN msseg_example_method_cpu.json`

## Execute the method with Boutiques

- Change the paths in `example_invocation.json` to reflect your data paths
- Find the tool to get its zenodo.ID: `bosh search MSSeg`
- Execute the tool: `bosh exec launch zenodo.4769886 example_invocation.json`, the -v option enables to mount a volume in the container.
